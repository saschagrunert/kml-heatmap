"use strict";var KMLHeatmapModules=(()=>{var U=Object.defineProperty;var Vt=Object.getOwnPropertyDescriptor;var zt=Object.getOwnPropertyNames;var Ct=Object.prototype.hasOwnProperty;var Et=(e,t)=>{for(var r in t)U(e,r,{get:t[r],enumerable:!0})},$t=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of zt(t))!Ct.call(e,a)&&a!==r&&U(e,a,{get:()=>t[a],enumerable:!(n=Vt(t,a))||n.enumerable});return e};var Bt=e=>$t(U({},"__esModule",{value:!0}),e);var jt={};Et(jt,{DataLoader:()=>v,aggregateAircraft:()=>k,calculateAircraftColorClass:()=>vt,calculateAirportFlightCounts:()=>it,calculateAirportMarkerSize:()=>lt,calculateAirportOpacity:()=>st,calculateAirportVisibility:()=>ct,calculateAirspeedRange:()=>$,calculateAltitudeRange:()=>E,calculateAltitudeStats:()=>V,calculateAutoZoom:()=>St,calculateBearing:()=>b,calculateDistance:()=>_,calculateFilteredStatistics:()=>nt,calculateFlightTime:()=>S,calculateLayerStats:()=>pt,calculateLongestFlight:()=>C,calculateReplayProgress:()=>At,calculateSegmentProperties:()=>ut,calculateSmoothedBearing:()=>yt,calculateSpeedStats:()=>z,calculateTimeRange:()=>_t,calculateTotalDistance:()=>T,calculateYearStats:()=>Lt,collectAirports:()=>P,ddToDms:()=>A,encodeStateToUrl:()=>X,filterPaths:()=>R,filterSegmentsForRendering:()=>dt,findHomeBase:()=>ot,findSegmentsAtTime:()=>bt,formatAirspeedLegendLabels:()=>mt,formatAltitude:()=>W,formatAltitudeLegendLabels:()=>ft,formatDistance:()=>j,formatSpeed:()=>Z,formatTime:()=>H,generateAirportPopup:()=>at,generateFunFacts:()=>wt,getColorForAirspeed:()=>J,getColorForAltitude:()=>G,getDefaultState:()=>tt,getDestinations:()=>Dt,getResolutionForZoom:()=>q,groupSegmentsByPath:()=>gt,interpolatePosition:()=>xt,mergeState:()=>et,parseUrlParams:()=>Q,prepareReplaySegments:()=>ht,replayCalculateBearing:()=>b,selectDiverseFacts:()=>K,shouldRecenter:()=>Mt,shouldRenderSegment:()=>B,validateReplayData:()=>Pt,wrappedFindHomeBase:()=>Ft});function _(e,t){let[r,n]=e,[a,i]=t,o=r*Math.PI/180,s=n*Math.PI/180,l=a*Math.PI/180,c=i*Math.PI/180,u=l-o,m=c-s,x=Math.sin(u/2)*Math.sin(u/2)+Math.cos(o)*Math.cos(l)*Math.sin(m/2)*Math.sin(m/2);return 6371*(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)))}function b(e,t,r,n){let a=e*Math.PI/180,i=r*Math.PI/180,o=(n-t)*Math.PI/180,s=Math.sin(o)*Math.cos(i),l=Math.cos(a)*Math.sin(i)-Math.sin(a)*Math.cos(i)*Math.cos(o);return(Math.atan2(s,l)*180/Math.PI+360)%360}function A(e,t){let r=e>=0?t?"N":"E":t?"S":"W";e=Math.abs(e);let n=Math.floor(e),a=Math.floor((e-n)*60),i=((e-n)*60-a)*60;return n+"\xB0"+a+"'"+i.toFixed(1)+'"'+r}function H(e){let t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?t+":"+r.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0"):r+":"+n.toString().padStart(2,"0")}function j(e,t=0){return e.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})+" km"}function W(e){return Math.round(e*3.28084).toLocaleString("en-US")+" ft"}function Z(e){return Math.round(e).toLocaleString("en-US")+" kt"}function q(e){return e<=4?"z0_4":e<=7?"z5_7":e<=10?"z8_10":e<=13?"z11_13":"z14_plus"}function G(e,t,r){let n=(e-t)/Math.max(r-t,1);n=Math.max(0,Math.min(1,n));let a,i,o;if(n<.2){let s=n/.2;a=Math.round(80*(1-s)),i=Math.round(160+95*s),o=255}else if(n<.4){let s=(n-.2)/.2;a=0,i=255,o=Math.round(255*(1-s))}else if(n<.6){let s=(n-.4)/.2;a=Math.round(255*s),i=255,o=0}else if(n<.8){let s=(n-.6)/.2;a=255,i=Math.round(255*(1-s*.35)),o=0}else{let s=(n-.8)/.2;a=255,i=Math.round(165*(1-s*.6)),o=Math.round(66*s)}return"rgb("+a+","+i+","+o+")"}function J(e,t,r){let n=(e-t)/Math.max(r-t,1);n=Math.max(0,Math.min(1,n));let a,i,o;if(n<.2){let s=n/.2;a=0,i=Math.round(128+127*s),o=255}else if(n<.4){let s=(n-.2)/.2;a=0,i=255,o=Math.round(255*(1-s))}else if(n<.6){let s=(n-.4)/.2;a=Math.round(255*s),i=255,o=0}else if(n<.8){let s=(n-.6)/.2;a=255,i=Math.round(255*(1-s*.5)),o=0}else{let s=(n-.8)/.2;a=255,i=Math.round(128*(1-s)),o=0}return"rgb("+a+","+i+","+o+")"}function Q(e){let t;if(typeof e=="string"?t=new URLSearchParams(e):t=e,t.toString()==="")return null;let r={};if(t.has("y")){let n=t.get("y");n&&(r.selectedYear=n)}if(t.has("a")){let n=t.get("a");n&&(r.selectedAircraft=n)}if(t.has("p")){let n=t.get("p");n&&(r.selectedPathIds=n.split(",").filter(a=>a.trim().length>0).map(a=>parseInt(a,10)).filter(a=>!isNaN(a)))}if(t.has("v")){let n=t.get("v");n&&(n.length===6||n.length===7||n.length===8)&&(r.heatmapVisible=n[0]==="1",r.altitudeVisible=n[1]==="1",r.airspeedVisible=n[2]==="1",r.airportsVisible=n[3]==="1",r.aviationVisible=n[4]==="1",r.statsPanelVisible=n[5]==="1",n.length>=7&&(r.wrappedVisible=n[6]==="1"),n.length===8&&(r.buttonsHidden=n[7]==="1"))}if(t.has("lat")&&t.has("lng")){let n=t.get("lat"),a=t.get("lng");if(n&&a){let i=parseFloat(n),o=parseFloat(a);!isNaN(i)&&!isNaN(o)&&i>=-90&&i<=90&&o>=-180&&o<=180&&(r.center={lat:i,lng:o})}}if(t.has("z")){let n=t.get("z");if(n){let a=parseFloat(n);isNaN(a)||(r.zoom=Math.max(1,Math.min(18,a)))}}return r}function X(e){let t=new URLSearchParams;if(e.selectedYear&&t.set("y",e.selectedYear),e.selectedAircraft&&e.selectedAircraft!=="all"&&t.set("a",e.selectedAircraft),e.selectedPathIds&&e.selectedPathIds.length>0&&t.set("p",e.selectedPathIds.join(",")),e.heatmapVisible!==void 0||e.altitudeVisible!==void 0||e.airspeedVisible!==void 0||e.airportsVisible!==void 0||e.aviationVisible!==void 0||e.statsPanelVisible!==void 0||e.wrappedVisible!==void 0||e.buttonsHidden!==void 0){let n=[e.heatmapVisible?"1":"0",e.altitudeVisible?"1":"0",e.airspeedVisible?"1":"0",e.airportsVisible?"1":"0",e.aviationVisible?"1":"0",e.statsPanelVisible?"1":"0",e.wrappedVisible?"1":"0",e.buttonsHidden?"1":"0"].join("");n!=="10010000"&&t.set("v",n)}return e.center&&(t.set("lat",e.center.lat.toFixed(6)),t.set("lng",e.center.lng.toFixed(6))),e.zoom!==void 0&&t.set("z",e.zoom.toFixed(2)),t.toString()}function tt(){return{selectedYear:"all",selectedAircraft:"all",selectedPathIds:[],heatmapVisible:!0,altitudeVisible:!1,airspeedVisible:!1,airportsVisible:!0,aviationVisible:!1,statsPanelVisible:!1,wrappedVisible:!1,buttonsHidden:!1}}function et(e,t){return t?{...e,...t}:{...e}}function R(e,t,r){return e.filter(function(n){return!(t!=="all"&&(!n.year||n.year.toString()!==t)||r!=="all"&&(!n.aircraft_registration||n.aircraft_registration!==r))})}function P(e){let t=new Set;return e.forEach(function(r){r.start_airport&&t.add(r.start_airport),r.end_airport&&t.add(r.end_airport)}),t}function k(e){let t={};return e.forEach(function(r){if(r.aircraft_registration){let n=r.aircraft_registration;t[n]||(t[n]={registration:n,type:r.aircraft_type,flights:0}),t[n].flights+=1}}),Object.values(t).sort(function(r,n){return n.flights-r.flights})}function I(e,t){let r=new Set(t.map(n=>n.id));return e.filter(function(n){return r.has(n.path_id)})}function T(e){let t=0;return e.forEach(function(r){let n=r.coords;if(n&&n.length===2){let a=_(n[0],n[1]);t+=a}}),t}function V(e){let t=e.map(o=>o.altitude_m).filter(o=>o!==void 0);if(t.length===0)return{min:0,max:0,gain:0};let r=t[0]??0,n=t[0]??0;for(let o=1;o<t.length;o++){let s=t[o]??0;s<r&&(r=s),s>n&&(n=s)}let a=0,i=null;return e.forEach(function(o){o.altitude_m!==void 0&&i!==null&&o.altitude_m>i&&(a+=o.altitude_m-i),o.altitude_m!==void 0&&(i=o.altitude_m)}),{min:r,max:n,gain:a}}function z(e){let t=e.map(i=>i.groundspeed_knots).filter(i=>i!==void 0&&i>0);if(t.length===0)return{max:0,avg:0};let r=t[0]??0,n=0;for(let i=0;i<t.length;i++){let o=t[i]??0;o>r&&(r=o),n+=o}let a=n/t.length;return{max:r,avg:a}}function C(e){let t={};e.forEach(function(a){let i=a.coords;if(i&&i.length===2){let o=_(i[0],i[1]);t[a.path_id]||(t[a.path_id]=0),t[a.path_id]+=o}});let r=Object.values(t);if(r.length===0)return 0;let n=r[0]??0;for(let a=1;a<r.length;a++){let i=r[a]??0;i>n&&(n=i)}return n}function S(e,t){let r=0;return new Set(t.map(a=>a.id)).forEach(function(a){let i=e.filter(o=>o.path_id===a&&o.time!==void 0&&o.time!==null);if(i.length>0){let o=i.map(c=>c.time),s=o[0]??0,l=o[0]??0;for(let c=1;c<o.length;c++){let u=o[c]??0;u<s&&(s=u),u>l&&(l=u)}r+=l-s}}),r}function nt(e){let{pathInfo:t,segments:r,year:n="all",aircraft:a="all"}=e;if(!t||!r)return{total_points:0,num_paths:0,num_airports:0,airport_names:[],num_aircraft:0,aircraft_list:[],total_distance_nm:0,total_distance_km:0};let i=R(t,n,a);if(i.length===0)return{total_points:0,num_paths:0,num_airports:0,airport_names:[],num_aircraft:0,aircraft_list:[],total_distance_nm:0,total_distance_km:0};let o=P(i),s=k(i),l=I(r,i),c=T(l),u=V(l),m=z(l),x=C(l),h=S(l,i),N=u.max!==void 0?u.max*3.28084:void 0,f=u.min!==void 0?u.min*3.28084:void 0,d=u.gain!==void 0?u.gain*3.28084:void 0,Y=x!==void 0?x*.539957:void 0,F=g=>{let y=Math.floor(g/3600),p=Math.floor(g%3600/60);return`${y}h ${p}m`},L=h>0?F(h):void 0,M=l.filter(g=>g.altitude_m&&g.altitude_m>304.8&&g.groundspeed_knots&&g.groundspeed_knots>0),Rt;if(M.length>0){let g=0,y=0;M.forEach(p=>{if(p.coords&&p.coords.length===2&&p.groundspeed_knots&&p.groundspeed_knots>0){let w=_(p.coords[0],p.coords[1])*.539957,Tt=w/p.groundspeed_knots;g+=w,y+=Tt}}),Rt=y>0?g/y:void 0}let O,kt;if(M.length>0){let g={};M.forEach(p=>{if(p.altitude_m){let D=p.altitude_m*3.28084,w=Math.round(D/100)*100;g[w]=(g[w]||0)+1}});let y=Object.entries(g).sort((p,D)=>D[1]-p[1])[0];y&&(O=Number(y[0]),kt=O/3.28084)}return{total_points:l.length*2,num_paths:i.length,num_airports:o.size,airport_names:Array.from(o),num_aircraft:s.length,aircraft_list:s,total_distance_km:c,total_distance_nm:c*.539957,max_altitude_m:u.max,min_altitude_m:u.min,total_altitude_gain_m:u.gain,max_altitude_ft:N,min_altitude_ft:f,total_altitude_gain_ft:d,max_groundspeed_knots:m.max,avg_groundspeed_knots:m.avg,average_groundspeed_knots:m.avg,cruise_speed_knots:Rt,longest_flight_km:x,longest_flight_nm:Y,total_flight_time_seconds:h,total_flight_time_str:L,most_common_cruise_altitude_ft:O,most_common_cruise_altitude_m:kt}}var Kt=["z0_4","z5_7","z8_10","z11_13","z14_plus"];function Nt(e){if(e==="all")return!0;let t=parseInt(e,10);return/^\d{4}$/.test(e)&&t>=2e3&&t<=2099}function Yt(e){return Kt.includes(e)}function Ot(e){return new Promise((t,r)=>{let n=document.createElement("script");n.src=e,n.onload=()=>t(),n.onerror=()=>r(new Error("Failed to load script: "+e)),document.head.appendChild(n)})}function Ut(e,t){let r={coordinates:[],path_segments:[],path_info:[],resolution:t,original_points:0,downsampled_points:0,compression_ratio:100};return e.forEach(n=>{n&&(n.coordinates&&(r.coordinates=r.coordinates.concat(n.coordinates)),n.path_segments&&(r.path_segments=r.path_segments.concat(n.path_segments)),n.path_info&&(r.path_info=r.path_info.concat(n.path_info)),r.original_points+=n.original_points||0,r.downsampled_points+=n.downsampled_points||0)}),r.compression_ratio=r.original_points>0?r.downsampled_points/r.original_points*100:100,r}function Ht(e,t){return"KML_DATA_"+e+"_"+t.toUpperCase().replace(/-/g,"_")}function rt(e,t){return e+"_"+t}var v=class{constructor(t={}){this.dataDir=t.dataDir||"data",this.cache={},this.scriptLoader=t.scriptLoader||Ot,this.showLoading=t.showLoading||(()=>{}),this.hideLoading=t.hideLoading||(()=>{}),this.getWindow=t.getWindow||(()=>window)}async loadData(t,r="all"){if(!Nt(r)||!Yt(t))return null;let n=rt(t,r);if(this.cache[n])return this.cache[n];if(r==="all")return await this.loadAndCombineAllYears(t);this.showLoading();try{let a=Ht(r,t),i=this.getWindow();if(!i[a]){let s=this.dataDir+"/"+r+"/"+t+".js";await this.scriptLoader(s)}let o=i[a];return this.cache[n]=o,o}catch{return null}finally{this.hideLoading()}}async loadAndCombineAllYears(t){let r=rt(t,"all");if(this.cache[r])return this.cache[r];this.showLoading();try{let n=await this.loadMetadata();if(!n||!n.available_years)return null;let a=n.available_years.map(s=>this.loadData(t,s.toString())),i=await Promise.all(a),o=Ut(i,t);return this.cache[r]=o,o}catch{return null}finally{this.hideLoading()}}async loadAirports(){try{let t=this.getWindow();return t.KML_AIRPORTS||await this.scriptLoader(this.dataDir+"/airports.js"),t.KML_AIRPORTS?.airports||[]}catch{return[]}}async loadMetadata(){try{let t=this.getWindow();return t.KML_METADATA||await this.scriptLoader(this.dataDir+"/metadata.js"),t.KML_METADATA||null}catch{return null}}clearCache(){this.cache={}}isCached(t,r){return rt(t,r)in this.cache}};function it(e,t="all",r="all"){if(!e)return{};let n={};return e.filter(function(i){return!(t!=="all"&&(!i.year||i.year.toString()!==t)||r!=="all"&&(!i.aircraft_registration||i.aircraft_registration!==r))}).forEach(function(i){let o=new Set;i.start_airport&&o.add(i.start_airport),i.end_airport&&o.add(i.end_airport),o.forEach(function(s){n[s]=(n[s]||0)+1})}),n}function ot(e){let t=null,r=0;return Object.keys(e).forEach(function(n){e[n]>r&&(r=e[n],t=n)}),t}function at(e,t,r){let n=A(e.lat,!0),a=A(e.lon,!1),i=`https://www.google.com/maps?q=${e.lat},${e.lon}`;return`
    <div style="
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        min-width: 220px;
        padding: 8px 4px;
        background-color: #2b2b2b;
        color: #ffffff;
    ">
        <div style="
            font-size: 15px;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #28a745;
            display: flex;
            align-items: center;
            gap: 6px;
        ">
            <span style="font-size: 18px;">\u{1F6EB}</span>
            <span>${e.name||"Unknown"}</span>
            ${r?'<span style="font-size: 12px; background: #007bff; color: white; padding: 2px 6px; border-radius: 3px; margin-left: 4px;">HOME</span>':""}
        </div>
        <div style="margin-bottom: 8px;">
            <div style="font-size: 11px; color: #999; margin-bottom: 2px; text-transform: uppercase; letter-spacing: 0.5px;">Coordinates</div>
            <a href="${i}"
               target="_blank"
               style="
                   color: #4facfe;
                   text-decoration: none;
                   font-size: 12px;
                   font-family: monospace;
                   display: flex;
                   align-items: center;
                   gap: 4px;
               "
               onmouseover="this.style.textDecoration='underline'"
               onmouseout="this.style.textDecoration='none'">
                <span>\u{1F4CD}</span>
                <span>${n}<br>${a}</span>
            </a>
        </div>
        <div style="
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.15) 0%, rgba(0, 242, 254, 0.15) 100%);
            padding: 8px 10px;
            border-radius: 6px;
            border-left: 3px solid #4facfe;
            display: flex;
            justify-content: space-between;
            align-items: center;
        ">
            <span style="font-size: 12px; color: #ccc; font-weight: 500;">Total Flights</span>
            <span style="font-size: 16px; font-weight: bold; color: #4facfe;">${t}</span>
        </div>
    </div>`}function st(e,t){if(t===0)return 1;let r=.3,n=1,a=e/t;return r+a*(n-r)}function lt(e,t,r={}){let n=r.minSize||3,a=r.maxSize||8;if(t===0)return n;let i=e/t;return n+i*(a-n)}function ct(e){let{airportCounts:t,selectedYear:r="all",selectedAircraft:n="all",selectedPathIds:a=new Set,pathToAirports:i={}}=e,o=r!=="all"||n!=="all",s=a.size>0,l=new Set;s&&a.forEach(u=>{let m=i[u];m&&(m.start&&l.add(m.start),m.end&&l.add(m.end))});let c={};return Object.keys(t).forEach(u=>{let m=t[u]||0;s?c[u]={show:!0,opacity:l.has(u)?1:.2}:o?c[u]={show:m>0,opacity:1}:c[u]={show:!0,opacity:1}}),c}function E(e,t=null){let r=e;if(t&&t.size>0&&(r=e.filter(o=>t.has(o.path_id))),r.length===0)return{min:0,max:1e4};let n=r.map(o=>o.altitude_ft).filter(o=>o!==void 0);if(n.length===0)return{min:0,max:1e4};let a=n[0]??0,i=n[0]??0;for(let o=1;o<n.length;o++){let s=n[o]??0;s<a&&(a=s),s>i&&(i=s)}return{min:a,max:i}}function $(e,t=null){let r=e;if(t&&t.size>0&&(r=e.filter(o=>t.has(o.path_id))),r.length===0)return{min:0,max:200};let n=r.map(o=>o.groundspeed_knots).filter(o=>o!==void 0&&o>0);if(n.length===0)return{min:0,max:200};let a=n[0]??0,i=n[0]??0;for(let o=1;o<n.length;o++){let s=n[o]??0;s<a&&(a=s),s>i&&(i=s)}return{min:a,max:i}}function B(e,t,r={}){let{year:n="all",aircraft:a="all"}=r;return!(n!=="all"&&(!t||!t.year||t.year.toString()!==n)||a!=="all"&&(!t||t.aircraft_registration!==a))}function ut(e,t={pathId:0}){let{pathId:r,selectedPathIds:n=new Set,hasSelection:a=!1,colorFunction:i,colorMin:o=0,colorMax:s=0,value:l=0}=t,c=n.has(r);return{weight:c?6:4,opacity:c?1:a?.1:.85,color:i?i(l,o,s):"#3388ff",isSelected:c}}function ft(e,t){return{min:Math.round(e).toLocaleString()+" ft",max:Math.round(t).toLocaleString()+" ft"}}function mt(e,t){return{min:Math.round(e)+" kt",max:Math.round(t)+" kt"}}function dt(e,t,r={}){let n=new Map(t.map(a=>[a.id,a]));return e.filter(a=>{let i=n.get(a.path_id);return i?B(a,i,r):!1})}function gt(e){let t=new Map;return e.forEach(r=>{let n=r.path_id;t.has(n)||t.set(n,[]),t.get(n).push(r)}),t}function pt(e){return{totalSegments:e.length,uniquePaths:new Set(e.map(t=>t.path_id)).size,altitudeRange:E(e),speedRange:$(e)}}function ht(e,t){return e.filter(n=>n.path_id===t&&n.time!==void 0&&n.time!==null).sort((n,a)=>n.time-a.time)}function _t(e){if(e.length===0)return{min:0,max:0};let t=e.map(a=>a.time),r=t[0]??0,n=t[0]??0;for(let a=1;a<t.length;a++){let i=t[a]??0;i<r&&(r=i),i>n&&(n=i)}return{min:r,max:n}}function bt(e,t){if(e.length===0)return{current:null,next:null,index:-1};let r=0;for(let n=0;n<e.length&&e[n].time<=t;n++)r=n;return{current:e[r]||null,next:e[r+1]||null,index:r}}function xt(e,t,r){if(!t||!e.coords)return{lat:e.coords[1][0],lon:e.coords[1][1],altitude:e.altitude_ft||0,speed:e.groundspeed_knots||0};let n=e.time,a=t.time,i=(r-n)/Math.max(a-n,.001),o=e.coords[1][0],s=e.coords[1][1],l=t.coords[0][0],c=t.coords[0][1];return{lat:o+(l-o)*i,lon:s+(c-s)*i,altitude:(e.altitude_ft||0)+((t.altitude_ft||0)-(e.altitude_ft||0))*i,speed:(e.groundspeed_knots||0)+((t.groundspeed_knots||0)-(e.groundspeed_knots||0))*i}}function yt(e,t,r=5){if(t<0||t>=e.length)return null;let n=e[t],a=Math.min(t+r,e.length-1),i=e[a];if(t===a){let o=n.coords;return o&&o.length===2?b(o[0][0],o[0][1],o[1][0],o[1][1]):null}return!n.coords||!i.coords?null:b(n.coords[1][0],n.coords[1][1],i.coords[0][0],i.coords[0][1])}function St(e,t,r={}){let{minZoom:n=10,maxZoom:a=16,cruiseAltitude:i=5e3,cruiseSpeed:o=100}=r,s=Math.min(e/i,2),l=Math.min(t/o,2),c=(s+l)/2,u=a-c*(a-n)/2;return Math.max(n,Math.min(a,Math.round(u)))}function Mt(e,t,r=.2){let n=t.north-t.south,a=t.east-t.west,i=n*r,o=a*r;return e.lat<t.south+i||e.lat>t.north-i||e.lon<t.west+o||e.lon>t.east-o}function At(e,t){return t===0?0:Math.min(100,e/t*100)}function Pt(e){return!e||e.length===0?{valid:!1,message:"No segments available for replay"}:e.filter(r=>r.time!==void 0&&r.time!==null).length===0?{valid:!1,message:"No timestamp data available. The flight may not have timing information."}:{valid:!0,message:"Replay data is valid"}}function It(e){let t=Math.floor(e/3600),r=Math.floor(e%3600/60);return`${t}h ${r}m`}function Lt(e,t,r,n=null){if(!e||e.length===0)return{total_flights:0,total_distance_nm:0,num_airports:0,airport_names:[],flight_time:"0h 0m",aircraft_list:[]};let a=r==="all"?"all":Number(r),i=a==="all"?e:e.filter(f=>f.year===a);if(i.length===0)return{total_flights:0,total_distance_nm:0,num_airports:0,airport_names:[],flight_time:"0h 0m",aircraft_list:[]};let o=P(i),s=Array.from(o),l=I(t,i),c=0;l.forEach(f=>{if(f.coords&&f.coords.length===2){let d=_(f.coords[0],f.coords[1]);c+=d}});let u=c*.539957,m=S(l,i),x=It(m),h={};i.forEach(f=>{if(f.aircraft_registration){let d=f.aircraft_registration;h[d]||(h[d]={registration:d,type:f.aircraft_type,flights:0,flight_time_seconds:0}),h[d].flights+=1}}),Object.keys(h).forEach(f=>{let d=i.filter(M=>M.aircraft_registration===f),Y=I(t,d),F=S(Y,d),L=h[f];L&&(L.flight_time_seconds=F,L.flight_time_str=It(F))}),n&&n.aircraft_list&&n.aircraft_list.forEach(f=>{let d=h[f.registration];d&&(d.model=f.model)});let N=Object.values(h).sort((f,d)=>d.flights-f.flights);return{total_flights:i.length,total_distance_nm:u,num_airports:o.size,airport_names:s,flight_time:x,aircraft_list:N}}function wt(e,t=null){let r=[],n=e.total_distance_nm,a=21639;if(n>a*.5){let o=(n/a).toFixed(1);r.push({icon:"\u{1F30D}",text:`You flew <strong>${o}x</strong> around the Earth!`,category:"distance",priority:10})}else n>1e3&&r.push({icon:"\u2708\uFE0F",text:`You covered <strong>${Math.round(n)} nautical miles</strong> this year!`,category:"distance",priority:8});let i=e.aircraft_list.length;if(i===1){let o=e.aircraft_list[0],s=o?.model||o?.type||o?.registration||"Unknown",l=e.total_flights,c=o?.registration||"";c?r.push({icon:"\u2708\uFE0F",text:`Loyal to <strong>${c}</strong> - all ${l} flight${l!==1?"s":""} in this ${s}!`,category:"aircraft",priority:9}):r.push({icon:"\u{1F499}",text:`Loyal to one aircraft: ${s}`,category:"aircraft",priority:7})}else i===2?r.push({icon:"\u2708\uFE0F",text:`You flew <strong>${i} different aircraft</strong> this year.`,category:"aircraft",priority:7}):i>=3&&r.push({icon:"\u{1F6E9}\uFE0F",text:`Aircraft explorer! You flew <strong>${i} different aircraft</strong>.`,category:"aircraft",priority:8});if(e.total_flights>0&&n>0){let o=Math.round(n/e.total_flights);o>0&&r.push({icon:"\u2708\uFE0F",text:`Cruising at <strong>${t?.cruise_speed_knots?Math.round(t.cruise_speed_knots):"?"} kt</strong>, averaging <strong>${o} nm</strong> per adventure`,category:"distance",priority:8})}if(t){if(t.longest_flight_nm&&t.longest_flight_nm>0){let o=Math.round(t.longest_flight_nm);r.push({icon:"\u{1F6EB}",text:`Your longest journey: <strong>${o} nm</strong> - that's Berlin to Munich distance!`,category:"distance",priority:8})}if(t.total_altitude_gain_ft){let o=Math.round(t.total_altitude_gain_ft);r.push({icon:"\u2B06\uFE0F",text:`Total elevation gain: <strong>${o.toLocaleString()} ft</strong>`,category:"altitude",priority:8});let s=29029;if(t.total_altitude_gain_ft>s){let l=(t.total_altitude_gain_ft/s).toFixed(1);r.push({icon:"\u{1F3D4}\uFE0F",text:`You climbed <strong>${l}x</strong> Mount Everest in altitude!`,category:"altitude",priority:9})}}if(t.most_common_cruise_altitude_ft&&t.most_common_cruise_altitude_m){let o=Math.round(t.most_common_cruise_altitude_ft),s=Math.round(t.most_common_cruise_altitude_m);r.push({icon:"\u2B06\uFE0F",text:`Most common cruise: <strong>${o.toLocaleString()} ft</strong> AGL (<strong>${s.toLocaleString()} m</strong>)`,category:"altitude",priority:7})}if(t.total_flight_time_seconds){let o=Math.floor(t.total_flight_time_seconds/3600);r.push({icon:"\u23F1\uFE0F",text:`Total flight time: <strong>${o} hours</strong> in the air!`,category:"time",priority:4})}t.cruise_speed_knots&&r.push({icon:"\u26A1",text:`Average cruise speed: <strong>${Math.round(t.cruise_speed_knots)} knots</strong>`,category:"speed",priority:3}),t.max_altitude_ft&&t.max_altitude_ft>4e4&&r.push({icon:"\u{1F680}",text:`High altitude achievement: <strong>${Math.round(t.max_altitude_ft)} feet</strong>!`,category:"achievement",priority:9})}return K(r)}function K(e){if(e.length===0)return[];let t=[...e].sort((s,l)=>l.priority-s.priority),r=[],n={},a=3,i=4,o=6;for(let s of t){let l=n[s.category]||0;if(l<a&&(r.push(s),n[s.category]=l+1),r.length>=o)break}if(r.length<i&&e.length>=i){for(let s of t)if(!r.includes(s)&&(r.push(s),r.length>=i))break}return r}function vt(e,t,r){if(t===r)return"fleet-aircraft-high";let n=(e-r)/(t-r);return n>=.75?"fleet-aircraft-high":n>=.5?"fleet-aircraft-medium-high":n>=.25?"fleet-aircraft-medium-low":"fleet-aircraft-low"}function Ft(e,t){if(!e||e.length===0)return null;let r=0,n="";return e.forEach(a=>{let i=t[a]||0;i>r&&(r=i,n=a)}),n?{name:n,flight_count:r}:null}function Dt(e,t){return e?t?e.filter(r=>r!==t):e:[]}typeof window<"u"&&(window.KMLHeatmap={calculateDistance:_,calculateBearing:b,ddToDms:A,formatTime:H,formatDistance:j,formatAltitude:W,formatSpeed:Z,getResolutionForZoom:q,getColorForAltitude:G,getColorForAirspeed:J,parseUrlParams:Q,encodeStateToUrl:X,getDefaultState:tt,mergeState:et,filterPaths:R,collectAirports:P,aggregateAircraft:k,calculateTotalDistance:T,calculateAltitudeStats:V,calculateSpeedStats:z,calculateLongestFlight:C,calculateFlightTime:S,calculateFilteredStatistics:nt,DataLoader:v,calculateAirportFlightCounts:it,findHomeBase:ot,generateAirportPopup:at,calculateAirportOpacity:st,calculateAirportMarkerSize:lt,calculateAirportVisibility:ct,calculateAltitudeRange:E,calculateAirspeedRange:$,shouldRenderSegment:B,calculateSegmentProperties:ut,formatAltitudeLegendLabels:ft,formatAirspeedLegendLabels:mt,filterSegmentsForRendering:dt,groupSegmentsByPath:gt,calculateLayerStats:pt,prepareReplaySegments:ht,calculateTimeRange:_t,findSegmentsAtTime:bt,interpolatePosition:xt,calculateSmoothedBearing:yt,replayCalculateBearing:b,calculateAutoZoom:St,shouldRecenter:Mt,calculateReplayProgress:At,validateReplayData:Pt,calculateYearStats:Lt,generateFunFacts:wt,selectDiverseFacts:K,calculateAircraftColorClass:vt,wrappedFindHomeBase:Ft,getDestinations:Dt});return Bt(jt);})();
