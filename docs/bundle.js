"use strict";var KMLHeatmapModules=(()=>{var W=Object.defineProperty;var Kt=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Yt=Object.prototype.hasOwnProperty;var Ot=(e,t)=>{for(var r in t)W(e,r,{get:t[r],enumerable:!0})},Ut=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Nt(t))!Yt.call(e,a)&&a!==r&&W(e,a,{get:()=>t[a],enumerable:!(n=Kt(t,a))||n.enumerable});return e};var Ht=e=>Ut(W({},"__esModule",{value:!0}),e);var te={};Ot(te,{DataLoader:()=>D,aggregateAircraft:()=>C,calculateAircraftColorClass:()=>Tt,calculateAirportFlightCounts:()=>ut,calculateAirportMarkerSize:()=>gt,calculateAirportOpacity:()=>dt,calculateAirportVisibility:()=>pt,calculateAirspeedRange:()=>N,calculateAltitudeRange:()=>K,calculateAltitudeStats:()=>z,calculateAutoZoom:()=>Lt,calculateBearing:()=>b,calculateDistance:()=>_,calculateFilteredStatistics:()=>st,calculateFlightTime:()=>M,calculateLayerStats:()=>St,calculateLongestFlight:()=>B,calculateReplayProgress:()=>Dt,calculateSegmentProperties:()=>ht,calculateSmoothedBearing:()=>vt,calculateSpeedStats:()=>$,calculateTimeRange:()=>Pt,calculateTotalDistance:()=>E,calculateYearStats:()=>Rt,collectAirports:()=>A,ddToDms:()=>P,encodeStateToUrl:()=>it,filterPaths:()=>T,filterSegmentsForRendering:()=>xt,findHomeBase:()=>ft,findMax:()=>et,findMin:()=>tt,findMinMax:()=>nt,findSegmentsAtTime:()=>At,formatAirspeedLegendLabels:()=>bt,formatAltitude:()=>G,formatAltitudeLegendLabels:()=>_t,formatDistance:()=>Z,formatSpeed:()=>J,formatTime:()=>q,generateAirportPopup:()=>mt,generateFunFacts:()=>It,getColorForAirspeed:()=>X,getColorForAltitude:()=>Q,getDefaultState:()=>ot,getDestinations:()=>Vt,groupSegmentsByPath:()=>yt,interpolatePosition:()=>wt,mergeState:()=>at,parseUrlParams:()=>rt,prepareReplaySegments:()=>Mt,replayCalculateBearing:()=>b,selectDiverseFacts:()=>O,shouldRecenter:()=>Ft,shouldRenderSegment:()=>Y,validateReplayData:()=>kt,wrappedFindHomeBase:()=>Ct});function _(e,t){let[r,n]=e,[a,o]=t,i=r*Math.PI/180,s=n*Math.PI/180,c=a*Math.PI/180,l=o*Math.PI/180,u=c-i,f=l-s,x=Math.sin(u/2)*Math.sin(u/2)+Math.cos(i)*Math.cos(c)*Math.sin(f/2)*Math.sin(f/2);return 6371*(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)))}function b(e,t,r,n){let a=e*Math.PI/180,o=r*Math.PI/180,i=(n-t)*Math.PI/180,s=Math.sin(i)*Math.cos(o),c=Math.cos(a)*Math.sin(o)-Math.sin(a)*Math.cos(o)*Math.cos(i);return(Math.atan2(s,c)*180/Math.PI+360)%360}function P(e,t){let r=e>=0?t?"N":"E":t?"S":"W";e=Math.abs(e);let n=Math.floor(e),a=Math.floor((e-n)*60),o=((e-n)*60-a)*60;return n+"\xB0"+a+"'"+o.toFixed(1)+'"'+r}function q(e){let t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?t+":"+r.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0"):r+":"+n.toString().padStart(2,"0")}function Z(e,t=0){return e.toFixed(t)+" km"}function G(e){return Math.round(e*3.28084)+" ft"}function J(e){return Math.round(e)+" kt"}function Q(e,t,r){let n=(e-t)/Math.max(r-t,1);n=Math.max(0,Math.min(1,n));let a,o,i;if(n<.2){let s=n/.2;a=Math.round(80*(1-s)),o=Math.round(160+95*s),i=255}else if(n<.4){let s=(n-.2)/.2;a=0,o=255,i=Math.round(255*(1-s))}else if(n<.6){let s=(n-.4)/.2;a=Math.round(255*s),o=255,i=0}else if(n<.8){let s=(n-.6)/.2;a=255,o=Math.round(255*(1-s*.35)),i=0}else{let s=(n-.8)/.2;a=255,o=Math.round(165*(1-s*.6)),i=Math.round(66*s)}return"rgb("+a+","+o+","+i+")"}function X(e,t,r){let n=(e-t)/Math.max(r-t,1);n=Math.max(0,Math.min(1,n));let a,o,i;if(n<.2){let s=n/.2;a=0,o=Math.round(128+127*s),i=255}else if(n<.4){let s=(n-.2)/.2;a=0,o=255,i=Math.round(255*(1-s))}else if(n<.6){let s=(n-.4)/.2;a=Math.round(255*s),o=255,i=0}else if(n<.8){let s=(n-.6)/.2;a=255,o=Math.round(255*(1-s*.5)),i=0}else{let s=(n-.8)/.2;a=255,o=Math.round(128*(1-s)),i=0}return"rgb("+a+","+o+","+i+")"}function tt(e){if(e.length===0)return 0;let t=e[0];for(let r=1;r<e.length;r++){let n=e[r];n<t&&(t=n)}return t}function et(e){if(e.length===0)return 0;let t=e[0];for(let r=1;r<e.length;r++){let n=e[r];n>t&&(t=n)}return t}function nt(e){if(e.length===0)return{min:0,max:0};let t=e[0],r=e[0];for(let n=1;n<e.length;n++){let a=e[n];a<t&&(t=a),a>r&&(r=a)}return{min:t,max:r}}function rt(e){let t;if(typeof e=="string"?t=new URLSearchParams(e):t=e,t.toString()==="")return null;let r={};if(t.has("y")){let n=t.get("y");n&&(r.selectedYear=n)}if(t.has("a")){let n=t.get("a");n&&(r.selectedAircraft=n)}if(t.has("p")){let n=t.get("p");n&&(r.selectedPathIds=n.split(",").filter(a=>a.trim().length>0).map(a=>parseInt(a,10)).filter(a=>!isNaN(a)))}if(t.has("v")){let n=t.get("v");n&&(n.length===6||n.length===7||n.length===8)&&(r.heatmapVisible=n[0]==="1",r.altitudeVisible=n[1]==="1",r.airspeedVisible=n[2]==="1",r.airportsVisible=n[3]==="1",r.aviationVisible=n[4]==="1",r.statsPanelVisible=n[5]==="1",n.length>=7&&(r.wrappedVisible=n[6]==="1"),n.length===8&&(r.buttonsHidden=n[7]==="1"))}if(t.has("lat")&&t.has("lng")){let n=t.get("lat"),a=t.get("lng");if(n&&a){let o=parseFloat(n),i=parseFloat(a);!isNaN(o)&&!isNaN(i)&&o>=-90&&o<=90&&i>=-180&&i<=180&&(r.center={lat:o,lng:i})}}if(t.has("z")){let n=t.get("z");if(n){let a=parseFloat(n);isNaN(a)||(r.zoom=Math.max(1,Math.min(18,a)))}}return r}function it(e){let t=new URLSearchParams,r=new URLSearchParams(window.location.search),n=["debug"];for(let o of n){let i=r.get(o);i!==null&&t.set(o,i)}if(e.selectedYear&&t.set("y",e.selectedYear),e.selectedAircraft&&e.selectedAircraft!=="all"&&t.set("a",e.selectedAircraft),e.selectedPathIds&&e.selectedPathIds.length>0&&t.set("p",e.selectedPathIds.join(",")),e.heatmapVisible!==void 0||e.altitudeVisible!==void 0||e.airspeedVisible!==void 0||e.airportsVisible!==void 0||e.aviationVisible!==void 0||e.statsPanelVisible!==void 0||e.wrappedVisible!==void 0||e.buttonsHidden!==void 0){let o=[e.heatmapVisible?"1":"0",e.altitudeVisible?"1":"0",e.airspeedVisible?"1":"0",e.airportsVisible?"1":"0",e.aviationVisible?"1":"0",e.statsPanelVisible?"1":"0",e.wrappedVisible?"1":"0",e.buttonsHidden?"1":"0"].join("");o!=="10010000"&&t.set("v",o)}return e.center&&(t.set("lat",e.center.lat.toFixed(6)),t.set("lng",e.center.lng.toFixed(6))),e.zoom!==void 0&&t.set("z",e.zoom.toFixed(2)),t.toString()}function ot(){return{selectedYear:"all",selectedAircraft:"all",selectedPathIds:[],heatmapVisible:!0,altitudeVisible:!1,airspeedVisible:!1,airportsVisible:!0,aviationVisible:!1,statsPanelVisible:!1,wrappedVisible:!1,buttonsHidden:!1}}function at(e,t){return t?{...e,...t}:{...e}}function T(e,t,r){return e.filter(function(n){return!(t!=="all"&&(!n.year||n.year.toString()!==t)||r!=="all"&&(!n.aircraft_registration||n.aircraft_registration!==r))})}function A(e){let t=new Set;return e.forEach(function(r){r.start_airport&&t.add(r.start_airport),r.end_airport&&t.add(r.end_airport)}),t}function C(e){let t={};return e.forEach(function(r){if(r.aircraft_registration){let n=r.aircraft_registration;t[n]||(t[n]={registration:n,type:r.aircraft_type,flights:0}),t[n].flights+=1}}),Object.values(t).sort(function(r,n){return n.flights-r.flights})}function V(e,t){let r=new Set(t.map(n=>n.id));return e.filter(function(n){return r.has(n.path_id)})}function E(e){let t=0;return e.forEach(function(r){let n=r.coords;if(n&&n.length===2){let a=_(n[0],n[1]);t+=a}}),t}function z(e){let t=e.map(i=>i.altitude_m).filter(i=>i!==void 0);if(t.length===0)return{min:0,max:0,gain:0};let r=t[0]??0,n=t[0]??0;for(let i=1;i<t.length;i++){let s=t[i]??0;s<r&&(r=s),s>n&&(n=s)}let a=0,o=null;return e.forEach(function(i){i.altitude_m!==void 0&&o!==null&&i.altitude_m>o&&(a+=i.altitude_m-o),i.altitude_m!==void 0&&(o=i.altitude_m)}),{min:r,max:n,gain:a}}function $(e){let t=e.map(o=>o.groundspeed_knots).filter(o=>o!==void 0&&o>0);if(t.length===0)return{max:0,avg:0};let r=t[0]??0,n=0;for(let o=0;o<t.length;o++){let i=t[o]??0;i>r&&(r=i),n+=i}let a=n/t.length;return{max:r,avg:a}}function B(e){let t={};e.forEach(function(a){let o=a.coords;if(o&&o.length===2){let i=_(o[0],o[1]);t[a.path_id]||(t[a.path_id]=0),t[a.path_id]+=i}});let r=Object.values(t);if(r.length===0)return 0;let n=r[0]??0;for(let a=1;a<r.length;a++){let o=r[a]??0;o>n&&(n=o)}return n}function M(e,t){let r=0;return new Set(t.map(a=>a.id)).forEach(function(a){let o=e.filter(i=>i.path_id===a&&i.time!==void 0&&i.time!==null);if(o.length>0){let i=o.map(l=>l.time),s=i[0]??0,c=i[0]??0;for(let l=1;l<i.length;l++){let u=i[l]??0;u<s&&(s=u),u>c&&(c=u)}r+=c-s}}),r}function st(e){let{pathInfo:t,segments:r,year:n="all",aircraft:a="all",coordinateCount:o}=e;if(!t||!r)return{total_points:0,num_paths:0,num_airports:0,airport_names:[],num_aircraft:0,aircraft_list:[],total_distance_nm:0,total_distance_km:0};let i=T(t,n,a);if(i.length===0)return{total_points:0,num_paths:0,num_airports:0,airport_names:[],num_aircraft:0,aircraft_list:[],total_distance_nm:0,total_distance_km:0};let s=A(i),c=C(i),l=V(r,i),u=E(l),f=z(l),x=$(l),h=B(l),w=M(l,i),m=f.max!==void 0?f.max*3.28084:void 0,d=f.min!==void 0?f.min*3.28084:void 0,U=f.gain!==void 0?f.gain*3.28084:void 0,k=h!==void 0?h*.539957:void 0,v=g=>{let y=Math.floor(g/3600),p=Math.floor(g%3600/60);return`${y}h ${p}m`},H=w>0?v(w):void 0,R=l.filter(g=>g.altitude_m&&g.altitude_m>304.8&&g.groundspeed_knots&&g.groundspeed_knots>0),Et;if(R.length>0){let g=0,y=0;R.forEach(p=>{if(p.coords&&p.coords.length===2&&p.groundspeed_knots&&p.groundspeed_knots>0){let L=_(p.coords[0],p.coords[1])*.539957,Bt=L/p.groundspeed_knots;g+=L,y+=Bt}}),Et=y>0?g/y:void 0}let j,zt;if(R.length>0){let g={};R.forEach(p=>{if(p.altitude_m){let I=p.altitude_m*3.28084,L=Math.round(I/100)*100;g[L]=(g[L]||0)+1}});let y=Object.entries(g).sort((p,I)=>I[1]-p[1])[0];y&&(j=Number(y[0]),zt=j/3.28084)}return{total_points:o??l.length*2,num_paths:i.length,num_airports:s.size,airport_names:Array.from(s),num_aircraft:c.length,aircraft_list:c,total_distance_km:u,total_distance_nm:u*.539957,max_altitude_m:f.max,min_altitude_m:f.min,total_altitude_gain_m:f.gain,max_altitude_ft:m,min_altitude_ft:d,total_altitude_gain_ft:U,max_groundspeed_knots:x.max,avg_groundspeed_knots:x.avg,average_groundspeed_knots:x.avg,cruise_speed_knots:Et,longest_flight_km:h,longest_flight_nm:k,total_flight_time_seconds:w,total_flight_time_str:H,most_common_cruise_altitude_ft:j,most_common_cruise_altitude_m:zt}}var lt=null;function jt(){lt=new URLSearchParams(window.location.search).get("debug")==="true"}function Wt(){lt===null&&jt()}function F(...e){Wt(),lt&&console.log(...e)}function S(...e){console.error(...e)}var qt=["data"];function Zt(e){if(e==="all")return!0;let t=parseInt(e,10);return/^\d{4}$/.test(e)&&t>=2e3&&t<=2099}function Gt(e){return qt.includes(e)}function Jt(e){return new Promise((t,r)=>{let n=document.createElement("script");n.src=e,n.onload=()=>t(),n.onerror=()=>r(new Error("Failed to load script: "+e)),document.head.appendChild(n)})}function Qt(e,t){let r={coordinates:[],path_segments:[],path_info:[],resolution:t,original_points:0};return e.forEach(n=>{n&&(n.coordinates&&(r.coordinates=r.coordinates.concat(n.coordinates)),n.path_segments&&(r.path_segments=r.path_segments.concat(n.path_segments)),n.path_info&&(r.path_info=r.path_info.concat(n.path_info)),r.original_points+=n.original_points||0)}),r}function Xt(e,t){return"KML_DATA_"+e+"_"+t.toUpperCase().replace(/-/g,"_")}function ct(e,t){return e+"_"+t}var D=class{constructor(t={}){this.dataDir=t.dataDir||"data",this.cache={},this.scriptLoader=t.scriptLoader||Jt,this.showLoading=t.showLoading||(()=>{}),this.hideLoading=t.hideLoading||(()=>{}),this.getWindow=t.getWindow||(()=>window)}async loadData(t,r="all"){if(!Zt(r))return S(`Invalid year parameter: ${r}`),null;if(!Gt(t))return S(`Invalid resolution parameter: ${t}`),null;let n=ct(t,r);if(this.cache[n])return this.cache[n];if(r==="all")return await this.loadAndCombineAllYears(t);this.showLoading();try{let a=Xt(r,t),o=this.getWindow();if(!o[a]){F("Loading "+t+" ("+r+")...");let s=this.dataDir+"/"+r+"/"+t+".js";await this.scriptLoader(s)}let i=o[a];return this.cache[n]=i,F("\u2713 Loaded "+t+" ("+r+"):",i.original_points+" points"),i}catch(a){return S("Error loading data for year "+r+":",a),null}finally{this.hideLoading()}}async loadAndCombineAllYears(t){let r=ct(t,"all");if(this.cache[r])return this.cache[r];this.showLoading();try{let n=await this.loadMetadata();if(!n||!n.available_years)return S("No metadata or available years found"),null;F("Loading all years for "+t+":",n.available_years);let a=n.available_years.map(s=>this.loadData(t,s.toString())),o=await Promise.all(a),i=Qt(o,t);return this.cache[r]=i,F("Combined all years for "+t+":",i.original_points+" points"),i}catch(n){return S("Error loading and combining all years:",n),null}finally{this.hideLoading()}}async loadAirports(){try{let t=this.getWindow();return t.KML_AIRPORTS||await this.scriptLoader(this.dataDir+"/airports.js"),t.KML_AIRPORTS?.airports||[]}catch(t){return S("Error loading airports:",t),[]}}async loadMetadata(){try{let t=this.getWindow();return t.KML_METADATA||await this.scriptLoader(this.dataDir+"/metadata.js"),t.KML_METADATA||null}catch(t){return S("Error loading metadata:",t),null}}clearCache(){this.cache={}}isCached(t,r){return ct(t,r)in this.cache}};function ut(e,t="all",r="all"){if(!e)return{};let n={};return e.filter(function(o){return!(t!=="all"&&(!o.year||o.year.toString()!==t)||r!=="all"&&(!o.aircraft_registration||o.aircraft_registration!==r))}).forEach(function(o){let i=new Set;o.start_airport&&i.add(o.start_airport),o.end_airport&&i.add(o.end_airport),i.forEach(function(s){n[s]=(n[s]||0)+1})}),n}function ft(e){let t=null,r=0;return Object.keys(e).forEach(function(n){e[n]>r&&(r=e[n],t=n)}),t}function mt(e,t,r){let n=P(e.lat,!0),a=P(e.lon,!1),o=`https://www.google.com/maps?q=${e.lat},${e.lon}`;return`
    <div style="
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        min-width: 220px;
        padding: 8px 4px;
        background-color: #2b2b2b;
        color: #ffffff;
    ">
        <div style="
            font-size: 15px;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #28a745;
            display: flex;
            align-items: center;
            gap: 6px;
        ">
            <span style="font-size: 18px;">\u{1F6EB}</span>
            <span>${e.name||"Unknown"}</span>
            ${r?'<span style="font-size: 12px; background: #007bff; color: white; padding: 2px 6px; border-radius: 3px; margin-left: 4px;">HOME</span>':""}
        </div>
        <div style="margin-bottom: 8px;">
            <div style="font-size: 11px; color: #999; margin-bottom: 2px; text-transform: uppercase; letter-spacing: 0.5px;">Coordinates</div>
            <a href="${o}"
               target="_blank"
               style="
                   color: #4facfe;
                   text-decoration: none;
                   font-size: 12px;
                   font-family: monospace;
                   display: flex;
                   align-items: center;
                   gap: 4px;
               "
               onmouseover="this.style.textDecoration='underline'"
               onmouseout="this.style.textDecoration='none'">
                <span>\u{1F4CD}</span>
                <span>${n}<br>${a}</span>
            </a>
        </div>
        <div style="
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.15) 0%, rgba(0, 242, 254, 0.15) 100%);
            padding: 8px 10px;
            border-radius: 6px;
            border-left: 3px solid #4facfe;
            display: flex;
            justify-content: space-between;
            align-items: center;
        ">
            <span style="font-size: 12px; color: #ccc; font-weight: 500;">Total Flights</span>
            <span style="font-size: 16px; font-weight: bold; color: #4facfe;">${t}</span>
        </div>
    </div>`}function dt(e,t){if(t===0)return 1;let r=.3,n=1,a=e/t;return r+a*(n-r)}function gt(e,t,r={}){let n=r.minSize||3,a=r.maxSize||8;if(t===0)return n;let o=e/t;return n+o*(a-n)}function pt(e){let{airportCounts:t,selectedYear:r="all",selectedAircraft:n="all",selectedPathIds:a=new Set,pathToAirports:o={}}=e,i=r!=="all"||n!=="all",s=a.size>0,c=new Set;s&&a.forEach(u=>{let f=o[u];f&&(f.start&&c.add(f.start),f.end&&c.add(f.end))});let l={};return Object.keys(t).forEach(u=>{let f=t[u]||0;s?l[u]={show:!0,opacity:c.has(u)?1:.2}:i?l[u]={show:f>0,opacity:1}:l[u]={show:!0,opacity:1}}),l}function K(e,t=null){let r=e;if(t&&t.size>0&&(r=e.filter(i=>t.has(i.path_id))),r.length===0)return{min:0,max:1e4};let n=r.map(i=>i.altitude_ft).filter(i=>i!==void 0);if(n.length===0)return{min:0,max:1e4};let a=n[0]??0,o=n[0]??0;for(let i=1;i<n.length;i++){let s=n[i]??0;s<a&&(a=s),s>o&&(o=s)}return{min:a,max:o}}function N(e,t=null){let r=e;if(t&&t.size>0&&(r=e.filter(i=>t.has(i.path_id))),r.length===0)return{min:0,max:200};let n=r.map(i=>i.groundspeed_knots).filter(i=>i!==void 0&&i>0);if(n.length===0)return{min:0,max:200};let a=n[0]??0,o=n[0]??0;for(let i=1;i<n.length;i++){let s=n[i]??0;s<a&&(a=s),s>o&&(o=s)}return{min:a,max:o}}function Y(e,t,r={}){let{year:n="all",aircraft:a="all"}=r;return!(n!=="all"&&(!t||!t.year||t.year.toString()!==n)||a!=="all"&&(!t||t.aircraft_registration!==a))}function ht(e,t={pathId:0}){let{pathId:r,selectedPathIds:n=new Set,hasSelection:a=!1,colorFunction:o,colorMin:i=0,colorMax:s=0,value:c=0}=t,l=n.has(r);return{weight:l?6:4,opacity:l?1:a?.1:.85,color:o?o(c,i,s):"#3388ff",isSelected:l}}function _t(e,t){return{min:Math.round(e)+" ft",max:Math.round(t)+" ft"}}function bt(e,t){return{min:Math.round(e)+" kt",max:Math.round(t)+" kt"}}function xt(e,t,r={}){let n=new Map(t.map(a=>[a.id,a]));return e.filter(a=>{let o=n.get(a.path_id);return o?Y(a,o,r):!1})}function yt(e){let t=new Map;return e.forEach(r=>{let n=r.path_id;t.has(n)||t.set(n,[]),t.get(n).push(r)}),t}function St(e){return{totalSegments:e.length,uniquePaths:new Set(e.map(t=>t.path_id)).size,altitudeRange:K(e),speedRange:N(e)}}function Mt(e,t){return e.filter(n=>n.path_id===t&&n.time!==void 0&&n.time!==null).sort((n,a)=>n.time-a.time)}function Pt(e){if(e.length===0)return{min:0,max:0};let t=e.map(a=>a.time),r=t[0]??0,n=t[0]??0;for(let a=1;a<t.length;a++){let o=t[a]??0;o<r&&(r=o),o>n&&(n=o)}return{min:r,max:n}}function At(e,t){if(e.length===0)return{current:null,next:null,index:-1};let r=0;for(let n=0;n<e.length&&e[n].time<=t;n++)r=n;return{current:e[r]||null,next:e[r+1]||null,index:r}}function wt(e,t,r){if(!t||!e.coords)return{lat:e.coords[1][0],lon:e.coords[1][1],altitude:e.altitude_ft||0,speed:e.groundspeed_knots||0};let n=e.time,a=t.time,o=(r-n)/Math.max(a-n,.001),i=e.coords[1][0],s=e.coords[1][1],c=t.coords[0][0],l=t.coords[0][1];return{lat:i+(c-i)*o,lon:s+(l-s)*o,altitude:(e.altitude_ft||0)+((t.altitude_ft||0)-(e.altitude_ft||0))*o,speed:(e.groundspeed_knots||0)+((t.groundspeed_knots||0)-(e.groundspeed_knots||0))*o}}function vt(e,t,r=5){if(t<0||t>=e.length)return null;let n=e[t],a=Math.min(t+r,e.length-1),o=e[a];if(t===a){let i=n.coords;return i&&i.length===2?b(i[0][0],i[0][1],i[1][0],i[1][1]):null}return!n.coords||!o.coords?null:b(n.coords[1][0],n.coords[1][1],o.coords[0][0],o.coords[0][1])}function Lt(e,t,r={}){let{minZoom:n=10,maxZoom:a=16,cruiseAltitude:o=5e3,cruiseSpeed:i=100}=r,s=Math.min(e/o,2),c=Math.min(t/i,2),l=(s+c)/2,u=a-l*(a-n)/2;return Math.max(n,Math.min(a,Math.round(u)))}function Ft(e,t,r=.2){let n=t.north-t.south,a=t.east-t.west,o=n*r,i=a*r;return e.lat<t.south+o||e.lat>t.north-o||e.lon<t.west+i||e.lon>t.east-i}function Dt(e,t){return t===0?0:Math.min(100,e/t*100)}function kt(e){return!e||e.length===0?{valid:!1,message:"No segments available for replay"}:e.filter(r=>r.time!==void 0&&r.time!==null).length===0?{valid:!1,message:"No timestamp data available. The flight may not have timing information."}:{valid:!0,message:"Replay data is valid"}}function $t(e){let t=Math.floor(e/3600),r=Math.floor(e%3600/60);return`${t}h ${r}m`}function Rt(e,t,r,n=null){if(!e||e.length===0)return{total_flights:0,total_distance_nm:0,num_airports:0,airport_names:[],flight_time:"0h 0m",aircraft_list:[]};let a=r==="all"?"all":Number(r),o=a==="all"?e:e.filter(m=>m.year===a);if(o.length===0)return{total_flights:0,total_distance_nm:0,num_airports:0,airport_names:[],flight_time:"0h 0m",aircraft_list:[]};let i=A(o),s=Array.from(i),c=V(t,o),l=0;c.forEach(m=>{if(m.coords&&m.coords.length===2){let d=_(m.coords[0],m.coords[1]);l+=d}});let u=l*.539957,f=M(c,o),x=$t(f),h={};o.forEach(m=>{if(m.aircraft_registration){let d=m.aircraft_registration;h[d]||(h[d]={registration:d,type:m.aircraft_type,flights:0,flight_time_seconds:0}),h[d].flights+=1}}),Object.keys(h).forEach(m=>{let d=o.filter(H=>H.aircraft_registration===m),U=V(t,d),k=M(U,d),v=h[m];v&&(v.flight_time_seconds=k,v.flight_time_str=$t(k))}),n&&n.aircraft_list&&n.aircraft_list.forEach(m=>{let d=h[m.registration];d&&(d.model=m.model)});let w=Object.values(h).sort((m,d)=>d.flights-m.flights);return{total_flights:o.length,total_distance_nm:u,num_airports:i.size,airport_names:s,flight_time:x,aircraft_list:w}}function It(e,t=null){let r=[],n=e.total_distance_nm,a=21639;if(n>a*.5){let i=(n/a).toFixed(1);r.push({icon:"\u{1F30D}",text:`You flew <strong>${i}x</strong> around the Earth!`,category:"distance",priority:10})}else n>1e3&&r.push({icon:"\u2708\uFE0F",text:`You covered <strong>${Math.round(n)} nautical miles</strong> this year!`,category:"distance",priority:8});let o=e.aircraft_list.length;if(o===1){let i=e.aircraft_list[0],s=i?.model||i?.type||i?.registration||"Unknown",c=e.total_flights,l=i?.registration||"";l?r.push({icon:"\u2708\uFE0F",text:`Loyal to <strong>${l}</strong> - all ${c} flight${c!==1?"s":""} in this ${s}!`,category:"aircraft",priority:9}):r.push({icon:"\u{1F499}",text:`Loyal to one aircraft: ${s}`,category:"aircraft",priority:7})}else o===2?r.push({icon:"\u2708\uFE0F",text:`You flew <strong>${o} different aircraft</strong> this year.`,category:"aircraft",priority:7}):o>=3&&r.push({icon:"\u{1F6E9}\uFE0F",text:`Aircraft explorer! You flew <strong>${o} different aircraft</strong>.`,category:"aircraft",priority:8});if(e.total_flights>0&&n>0){let i=Math.round(n/e.total_flights);i>0&&(t?.cruise_speed_knots?r.push({icon:"\u2708\uFE0F",text:`Cruising at <strong>${Math.round(t.cruise_speed_knots)} kt</strong>, averaging <strong>${i} nm</strong> per adventure`,category:"distance",priority:8}):r.push({icon:"\u2708\uFE0F",text:`Averaging <strong>${i} nm</strong> per adventure`,category:"distance",priority:8}))}if(t){if(t.longest_flight_nm&&t.longest_flight_nm>0){let i=Math.round(t.longest_flight_nm);r.push({icon:"\u{1F6EB}",text:`Your longest journey: <strong>${i} nm</strong> - that's Berlin to Munich distance!`,category:"distance",priority:8})}if(t.total_altitude_gain_ft){let i=Math.round(t.total_altitude_gain_ft);r.push({icon:"\u2B06\uFE0F",text:`Total elevation gain: <strong>${i} ft</strong>`,category:"altitude",priority:8});let s=29029;if(t.total_altitude_gain_ft>s){let c=(t.total_altitude_gain_ft/s).toFixed(1);r.push({icon:"\u{1F3D4}\uFE0F",text:`You climbed <strong>${c}x</strong> Mount Everest in altitude!`,category:"altitude",priority:9})}}if(t.most_common_cruise_altitude_ft&&t.most_common_cruise_altitude_m){let i=Math.round(t.most_common_cruise_altitude_ft),s=Math.round(t.most_common_cruise_altitude_m);r.push({icon:"\u2B06\uFE0F",text:`Most common cruise: <strong>${i} ft</strong> AGL (<strong>${s} m</strong>)`,category:"altitude",priority:7})}if(t.total_flight_time_seconds){let i=Math.floor(t.total_flight_time_seconds/3600);r.push({icon:"\u23F1\uFE0F",text:`Total flight time: <strong>${i} hours</strong> in the air!`,category:"time",priority:4})}t.cruise_speed_knots&&r.push({icon:"\u26A1",text:`Average cruise speed: <strong>${Math.round(t.cruise_speed_knots)} knots</strong>`,category:"speed",priority:3}),t.max_altitude_ft&&t.max_altitude_ft>4e4&&r.push({icon:"\u{1F680}",text:`High altitude achievement: <strong>${Math.round(t.max_altitude_ft)} feet</strong>!`,category:"achievement",priority:9})}return O(r)}function O(e){if(e.length===0)return[];let t=[...e].sort((s,c)=>c.priority-s.priority),r=[],n={},a=3,o=4,i=6;for(let s of t){let c=n[s.category]||0;if(c<a&&(r.push(s),n[s.category]=c+1),r.length>=i)break}if(r.length<o&&e.length>=o){for(let s of t)if(!r.includes(s)&&(r.push(s),r.length>=o))break}return r}function Tt(e,t,r){if(t===r)return"fleet-aircraft-high";let n=(e-r)/(t-r);return n>=.75?"fleet-aircraft-high":n>=.5?"fleet-aircraft-medium-high":n>=.25?"fleet-aircraft-medium-low":"fleet-aircraft-low"}function Ct(e,t){if(!e||e.length===0)return null;let r=0,n="";return e.forEach(a=>{let o=t[a]||0;o>r&&(r=o,n=a)}),n?{name:n,flight_count:r}:null}function Vt(e,t){return e?t?e.filter(r=>r!==t):e:[]}typeof window<"u"&&(window.KMLHeatmap={calculateDistance:_,calculateBearing:b,ddToDms:P,formatTime:q,formatDistance:Z,formatAltitude:G,formatSpeed:J,getColorForAltitude:Q,getColorForAirspeed:X,findMin:tt,findMax:et,findMinMax:nt,parseUrlParams:rt,encodeStateToUrl:it,getDefaultState:ot,mergeState:at,filterPaths:T,collectAirports:A,aggregateAircraft:C,calculateTotalDistance:E,calculateAltitudeStats:z,calculateSpeedStats:$,calculateLongestFlight:B,calculateFlightTime:M,calculateFilteredStatistics:st,DataLoader:D,calculateAirportFlightCounts:ut,findHomeBase:ft,generateAirportPopup:mt,calculateAirportOpacity:dt,calculateAirportMarkerSize:gt,calculateAirportVisibility:pt,calculateAltitudeRange:K,calculateAirspeedRange:N,shouldRenderSegment:Y,calculateSegmentProperties:ht,formatAltitudeLegendLabels:_t,formatAirspeedLegendLabels:bt,filterSegmentsForRendering:xt,groupSegmentsByPath:yt,calculateLayerStats:St,prepareReplaySegments:Mt,calculateTimeRange:Pt,findSegmentsAtTime:At,interpolatePosition:wt,calculateSmoothedBearing:vt,replayCalculateBearing:b,calculateAutoZoom:Lt,shouldRecenter:Ft,calculateReplayProgress:Dt,validateReplayData:kt,calculateYearStats:Rt,generateFunFacts:It,selectDiverseFacts:O,calculateAircraftColorClass:Tt,wrappedFindHomeBase:Ct,getDestinations:Vt});return Ht(te);})();
